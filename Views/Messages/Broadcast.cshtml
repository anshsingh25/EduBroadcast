@{
        Layout = "~/Views/Shared/_Layout.cshtml";
        ViewData["Title"] = "Quick Message - Broadcast";
        var classes = ViewBag.Classes as IReadOnlyList<EduBroadcast.Models.ClassRoom>;
        var templates = ViewBag.Templates as IReadOnlyList<EduBroadcast.Models.MessageTemplate>;
}

<div class="row mb-4">
        <div class="col-12">
                <div class="d-flex justify-content-between align-items-center">
                        <h2 class="mb-0 reveal">
                                <i class="bi bi-megaphone-fill me-3" style="color: #6366f1;"></i>
                                Broadcast Message
                        </h2>
                        <a class="btn btn-outline-light reveal" href="/Messages/Templates">
                                <i class="bi bi-arrow-left me-2"></i>Back to Templates
                        </a>
                </div>
        </div>
</div>

@await Html.PartialAsync("~/Views/Shared/_Alerts.cshtml")

@if ((templates == null || templates.Count == 0) || (classes == null || classes.Count == 0))
{
        <div class="empty-state reveal">
                <div class="icon"><i class="bi bi-megaphone"></i></div>
                <p class="mb-1 fs-5 fw-bold">Setup Required</p>
                <p class="sc-muted mb-3">You need at least one template and one class to broadcast messages.</p>
                <a href="/Messages/Templates" class="btn btn-primary">
                        <i class="bi bi-plus-circle me-2"></i>Create Template
                </a>
        </div>
}
else
{
        <form method="post" asp-action="Broadcast">
                <div class="row g-4">
                        <div class="col-lg-8">
                                <div class="card reveal">
                                        <div class="card-body">
                                                <h4 class="card-title mb-4">
                                                        <i class="bi bi-gear me-2" style="color: #6366f1;"></i>
                                                        Message Configuration
                                                </h4>
                                                
                                                <div class="row g-3 mb-4">
                                                        <div class="col-md-6">
                                                                <label class="form-label">Select Template</label>
                                                                <select class="form-select" name="TemplateId" required>
                                                                        <option value="">Choose a template...</option>
                                                                        @foreach (var t in templates)
                                                                        {
                                                                                <option value="@t.Id">@t.Title</option>
                                                                        }
                                                                </select>
                                                        </div>
                                                        <div class="col-md-6">
                                                                <label class="form-label">Target Class (Optional)</label>
                                                                <select class="form-select" name="ClassId">
                                                                        <option value="">Select specific students below</option>
                                                                        @foreach (var c in classes)
                                                                        {
                                                                                <option value="@c.Id">@c.Name (All Students)</option>
                                                                        }
                                                                </select>
                                                        </div>
                                                </div>

                                                <div class="mb-4">
                                                        <label class="form-label mb-3">
                                                                <i class="bi bi-people me-2"></i>
                                                                Select Individual Students
                                                        </label>
                                                        <div class="row g-3">
                                                                @foreach (var c in classes)
                                                                {
                                                                        <div class="col-md-6">
                                                                                <div class="card border">
                                                                                        <div class="card-header" style="background: rgba(99,102,241,.1); border-bottom: 1px solid var(--sc-border);">
                                                                                                <strong>@c.Name</strong>
                                                                                        </div>
                                                                                        <ul class="list-group list-group-flush">
                                                                                                @foreach (var s in c.Students)
                                                                                                {
                                                                                                        <li class="list-group-item" style="background: transparent; border-color: var(--sc-border);">
                                                                                                                <div class="form-check">
                                                                                                                        <input class="form-check-input" type="checkbox" name="StudentIds" value="@s.Id" id="student_@s.Id">
                                                                                                                        <label class="form-check-label w-100" for="student_@s.Id">
                                                                                                                                @s.FullName
                                                                                                                        </label>
                                                                                                                </div>
                                                                                                        </li>
                                                                                                }
                                                                                        </ul>
                                                                                </div>
                                                                        </div>
                                                                }
                                                        </div>
                                                </div>

                                                <div class="pt-3" style="border-top: 1px solid var(--sc-border);">
                                                        <label class="form-label mb-3">
                                                                <i class="bi bi-send me-2"></i>
                                                                Delivery Methods
                                                        </label>
                                                        <div class="row g-3">
                                                                <div class="col-sm-6">
                                                                        <div class="form-check p-3 border rounded" style="border-color: var(--sc-border-light) !important;">
                                                                                <input class="form-check-input" type="checkbox" name="SendSms" value="true" id="sms">
                                                                                <label for="sms" class="form-check-label">
                                                                                        <strong><i class="bi bi-phone me-2"></i>Send via SMS</strong>
                                                                                        <br>
                                                                                        <small class="sc-muted">Text message to parent phone</small>
                                                                                </label>
                                                                        </div>
                                                                </div>
                                                                <div class="col-sm-6">
                                                                        <div class="form-check p-3 border rounded" style="border-color: var(--sc-border-light) !important;">
                                                                                <input class="form-check-input" type="checkbox" name="SendEmail" value="true" id="email">
                                                                                <label for="email" class="form-check-label">
                                                                                        <strong><i class="bi bi-envelope me-2"></i>Send via Email</strong>
                                                                                        <br>
                                                                                        <small class="sc-muted">Email to parent address</small>
                                                                                </label>
                                                                        </div>
                                                                </div>
                                                        </div>
                                                </div>
                                        </div>
                                </div>
                        </div>

                        <div class="col-lg-4">
                                <div class="position-sticky reveal" style="top: 20px;">
                                        <div class="card" style="background: linear-gradient(135deg, rgba(79,70,229,.15), rgba(6,182,212,.10));">
                                                <div class="card-body text-center py-4">
                                                        <i class="bi bi-send-check" style="font-size: 3rem; color: #6366f1; margin-bottom: 1rem; display: block;"></i>
                                                        <h5 class="card-title mb-3">Ready to Send?</h5>
                                                        <p class="sc-muted small mb-4">
                                                                Review your selections and choose at least one delivery method before sending.
                                                        </p>
                                                        <button type="submit" class="btn btn-primary w-100 btn-lg mb-2">
                                                                <i class="bi bi-send me-2"></i>Send Messages
                                                        </button>
                                                        <small class="sc-muted d-block mt-3">
                                                                <i class="bi bi-info-circle me-1"></i>
                                                                Messages will be logged to outbox
                                                        </small>
                                                </div>
                                        </div>
                                </div>
                        </div>
                </div>
        </form>
}


